#!/bin/bash

# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2025-present ROCKNIX (https://github.com/ROCKNIX)

. /etc/profile

# Disable rocknix-screenshot while retroarch is running
if pgrep -f "retroarch" > /dev/null; then
    echo "RetroArch is running, skipping screenshot."
    exit 1
fi

# Folder to save screenshots
SAVE_DIR="/storage/roms/screenshots"

# Create the folder if it doesn't exist
mkdir -p "$SAVE_DIR"

# Generate a timestamped filename
FILENAME="$(date +'%Y-%m-%d-%H%M%S').png"
FULL_PATH="${SAVE_DIR}/${FILENAME}"

# Get focused window geometry
GEOMETRY=$(swaymsg -t get_tree | jq -r '
  ..
  | select(.type? == "con" and .focused == true)
  | "\(.rect.x),\(.rect.y) \(.rect.width)x\(.rect.height)"'
)

# Take screenshot of the focused window
grim -g "$GEOMETRY" "$FULL_PATH"

echo "Screenshot saved to $FULL_PATH"

